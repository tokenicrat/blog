---
title: "Warp 代理模式和一些坑"
summary: "运行 Warp 代理，解决内存泄露问题"
topics: ["Cloudflare"]
date: "2025-07-15T15:01:57+08:00"
draft: false
katex: false
typora-root-url: ../../static
typora-copy-images-to: ../../static/img/${filename}
---

词元的 VPS 所在 IP 段不知道被哪个好人送中了，Gemini 玩不起来了。用 Cloudflare Warp 的免费 VPN 可以解锁。

## 安装

先添加 Cloudflare 存储库。

```bash
curl -fsSl https://pkg.cloudflareclient.com/cloudflare-warp-ascii.repo | sudo tee /etc/yum.repos.d/cloudflare-warp.repo
```

然后安装。

```bash
sudo dnf update && sudo dnf install cloudflare-warp
```

注册新客户端。

```bash
sudo warp-cli registration new
```

## 启用代理模式

默认情况下，Warp 会接管系统代理，但是内核会与其发生奇怪的冲突，而且也无法做到分流。因此，我们采用代理模式。

```bash
sudo warp-cli mode proxy
```

然后设置代理模式的端口，Warp 会在该端口上开启一个 SOCKS5 代理服务器。

```bash
sudo warp-cli proxy port 9090
```

最后连接。

```bash
sudo warp-cli connect
```

## 定期重启

Cloudflare Warp 客户端有内存泄漏的问题，运行一两天之后会占用 2GB 以上的内存。Cloudflare 似乎没有修复的计划，目前最简单的解决方案就是定时重启。

```bash
sudo crontab -e
```

在 crontab 中添加

```
0 * * * * /bin/systemctl restart warp-svc
```

表示每个小时重启一次 Warp 客户端。

## 下课

最后，在您使用的内核的配置文件中，添加一个 SOCKS 出站即可。
